light.has("/alipay/security/barcode")||function(e){var f={Name:"barcode"},f=e.barcode=light.deriveFrom(e.base,{render:function(a){var b=this;light.isFunction(a)&&b._readyList.push(a);seajs.use(["$","alipay/qrcode/1.0.3/qrcode"],function(a,g){var d=new g({text:b.options.barcode,width:b.options.width,height:b.options.height});b.element&&b.element.del();b.container.append(d);b.element=light.node(d);b.element.addClass("barcode");b.ready=!0;for(d=b._readyList;d.length;)d.shift().apply(b)})},postInit:function(){this.container=
light.node(light.node(this.options.container));this.stat="suspended";for(var a=this,b=this.container.find("button"),c=0;c<b.length;c++)light.on(b[c],"click",function(){a._changeState("waiting")});this._confirmedList=[]},start:function(){"confirmed"!=this.stat&&this._changeState("waiting")},stop:function(){"confirmed"!=this.stat&&this._changeState("suspended")},onConfirm:function(a){if("function"!=typeof a)throw Error("onConfirm accept only function.");this._confirmedList.push(a);if("confirmed"==this.stat){for(a=
this._confirmedList;a.length;)a.shift().apply(this);this._confirmedList=[]}},getValue:function(){return"confirmed"==this.stat},_changeState:function(a){var b=this.stat;if(a!=b){switch(b){case "scanned":this.container.removeClass("scanned");break;case "confirmed":this.container.removeClass("confirmed");break;case "error":this.container.removeClass("error");break;case "timeout":this.container.removeClass("timeout")}this.stat=a;switch(a){case "suspended":clearInterval(this._intervalHandler);clearTimeout(this._timeoutHandler);
break;case "waiting":var c=this;clearInterval(this._intervalHandler);clearTimeout(this._timeoutHandler);this._intervalHandler=setInterval(function(){light.request(c.options.queryUrl,{securityId:c.options.securityId},{method:"JSONP",success:function(a){"ok"==a.stat?c._changeState(a.barcodeStatus):(c._changeState("error"),light.log(a))},failure:function(){light.log("failure")}})},3E3);this._timeoutHandler=setTimeout(function(){c._changeState("timeout")},6E5);break;case "scanned":this.container.addClass("scanned");
break;case "confirmed":clearInterval(this._intervalHandler);clearTimeout(this._timeoutHandler);this.container.addClass("confirmed");for(a=this._confirmedList;a.length;)a.shift().apply(this);this._confirmedList=[];break;case "error":clearInterval(this._intervalHandler);clearTimeout(this._timeoutHandler);this.container.addClass("error");break;case "timeout":clearInterval(this._intervalHandler);clearTimeout(this._timeoutHandler);this.container.addClass("timeout");break;default:light.log("barcod error")}}}},
f)}(alipay.security);